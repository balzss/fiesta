(this.webpackJsonpfiesta=this.webpackJsonpfiesta||[]).push([[0],{31:function(e,t,a){e.exports=a(60)},36:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a.n(o),s=a(14),i=a.n(s),r=(a(36),a(19)),c=a(3),l=a(15);function d(e,t){localStorage.setItem(e,function(e){return btoa(JSON.stringify(e))}(t))}function u(e,t,a){var o=m(e);if(!o)return!1;o[t]=a,d(e,o)}function m(e){var t=localStorage.getItem(e);return!!t&&function(e){return JSON.parse(atob(e))}(t)}var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(o,n){var s=Object({NODE_ENV:"production",PUBLIC_URL:"/fiesta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEERJS,i=Object({NODE_ENV:"production",PUBLIC_URL:"/fiesta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_TURN,r=Object({NODE_ENV:"production",PUBLIC_URL:"/fiesta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_TURN_USERNAME,c=Object({NODE_ENV:"production",PUBLIC_URL:"/fiesta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_TURN_CREDENTIALS,l=window.Peer,d={debug:2,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]}};s&&(d.host=s,d.port="",d.path="/myapp"),i&&d.config.iceServers.push({urls:i,username:r,credential:c});var u=a?new l(a,d):new l(d);(window.peer_obj=u,window.is_host=e,e)||p(u.connect(t));u.on("open",(function(e){window.peer_id=u.id,o(u.id,window.is_host)})),u.on("connection",(function(e){console.log("connection called"),p(e)})),u.on("close",(function(){console.log("peer closed"),window.global_this_obj.notify("Network disconnected please refresh",1e4)})),u.on("disconnected",(function(){console.log("peer disconnected"),window.global_this_obj.notify("Network disconnected please refresh",1e4)}))}))};function p(e){e.on("data",(function(e){!function(e){"object"===typeof e&&null!==e&&("chat"===e.data_type?v(e):"new_connection"===e.data_type?b(e.peer_id):"youtube"===e.data_type?function(e){if(""===window.global_this_obj.state.youtube_video_id)window.global_this_obj.setState({youtube_video_id:e.videoId,youtube_current_pos:Math.ceil(e.startSeconds),player_state:e.event});else{window.global_this_obj.setState({isStateChangeFromBroadcastData:!0});var t=window.yt_player;2===e.event?(t.seekTo(e.startSeconds,!0),t.pauseVideo(),window.global_this_obj.notify("".concat(e.user_name," paused the video"))):1===e.event?(t.seekTo(Math.ceil(e.startSeconds),!0),t.playVideo(),window.global_this_obj.notify("".concat(e.user_name," started the video"))):3===e.event?(t.seekTo(e.startSeconds,!0),t.pauseVideo(),window.global_this_obj.notify("".concat(e.user_name," is buffering"))):"playbackRateChange"===e.event&&(t.seekTo(e.startSeconds,!0),t.setPlaybackRate(e.playbackRate),window.global_this_obj.notify("".concat(e.user_name," changed the playback rate to ").concat(e.playbackRate,"x"))),setTimeout((function(){window.global_this_obj.setState({isStateChangeFromBroadcastData:!1})}),2500)}}(e):"intro"===e.data_type?function(e){var t=window.global_this_obj.state.connected_users;t[e.peer_id]={user_name:e.user_name,color_code:e.color_code},window.global_this_obj.setState({connected_users:t}),window.global_this_obj.notify("".concat(e.user_name," has joined the party")),window.is_host&&(u(window.peer_obj.id,"connected_users",t),setTimeout((function(){w(),h({data_type:"user_list",user_list:window.global_this_obj.state.connected_users,only_host_controls:window.global_this_obj.state.only_host_controls})}),250))}(e):"user_list"===e.data_type?function(e){window.global_this_obj.setState({connected_users:e.user_list,only_host_controls:e.only_host_controls})}(e):"change_video"===e.data_type&&E(e.video_id))}(e)})),e.on("close",(function(){var t=window.global_this_obj.state.connected_users;if(t&&t[e.peer]){var a=t[e.peer].user_name;delete t[e.peer],window.global_this_obj.setState({connected_users:t}),window.global_this_obj.notify("".concat(a," has left the party")),window.is_host&&u(window.peer_obj.id,"connected_users",t)}})),window.connections.push(e),!0===window.is_host&&function(e){for(var t={data_type:"new_connection",peer_id:e},a=0;a<window.connections.length;a++)window.connections[a].peer!==e&&window.connections[a].send(t)}(e.peer)}function h(e){window.connections.forEach((function(t){t.send(e)}))}function b(e){p(window.peer_obj.connect(e))}function v(e){var t=window.global_this_obj.state.chat_log;e.message=decodeURIComponent(escape(window.atob(e.message))),t.push(e),window.global_this_obj.setState({chat_log:t})}function f(e,t,a,o){var n=function(e,t,a,o){return{data_type:"chat",user_name:t,user_type:a?"Host":"Client",message:btoa(unescape(encodeURIComponent(e))),color_code:o,time_stamp:Date.now()}}(e,t,a,o);h(n),v(n)}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if((!0!==window.global_this_obj.state.only_host_controls||!0===window.is_host)&&!window.global_this_obj.state.isStateChangeFromBroadcastData){var t=y(e);h(t)}}function y(e){var t,a=window.yt_player;t=null!==e?e:a.getPlayerState();var o=a.getVideoData().video_id,n=a.getCurrentTime(),s=a.getPlaybackRate();return{data_type:"youtube",user_name:window.global_this_obj.state.user_name,event:t,videoId:o,startSeconds:n,playbackRate:s}}function g(e,t){h({data_type:"intro",user_name:e,peer_id:window.peer_obj.id,color_code:t,time_stamp:Date.now()})}function E(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=window.yt_player;if(a.loadVideoById(e),t){var o={data_type:"change_video",video_id:e};h(o)}}function N(e){var t=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!t||11!==t[2].length)&&t[2]}var S=function(){var e=Object(o.useState)(""),t=Object(l.a)(e,2),a=t[0],s=t[1],i=Object(o.useState)(""),r=Object(l.a)(i,2),u=r[0],m=r[1],p=Object(o.useState)(!1),h=Object(l.a)(p,2),b=h[0],v=h[1],f=Object(o.useState)(null),w=Object(l.a)(f,2),y=w[0],g=w[1],E=Object(o.useState)(!1),S=Object(l.a)(E,2),O=S[0],j=S[1];Object(o.useEffect)((function(){navigator.clipboard&&navigator.clipboard.readText().then((function(e){v(N(e))}))}),[]);if(y){var C=b||N(u);return d(y,{userName:a,videoUrl:u,videoId:C,isHost:!0,onlyHostControls:!1}),n.a.createElement(c.a,{push:!0,to:{pathname:y}})}return n.a.createElement("section",{className:"section"},n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"columns is-centered"},n.a.createElement("div",{className:"column is-half"},n.a.createElement("div",{className:"card box"},n.a.createElement("div",{className:"card-content"},n.a.createElement("form",{onSubmit:function(e){e.preventDefault(),j(!0),_(!0).then((function(e){g(e)}))}},n.a.createElement("div",{className:"field"},n.a.createElement("label",{className:"label"},"Username"),n.a.createElement("div",{className:"control"},n.a.createElement("input",{className:"input",placeholder:"Please enter your username",type:"text",value:a,onChange:function(e){return s(e.target.value)},required:!0}))),n.a.createElement("div",{className:"field"},n.a.createElement("label",{className:"label"},"Youtube Link"),n.a.createElement("div",{className:"field has-addons"},n.a.createElement("div",{className:"control",style:{flex:"1"}},n.a.createElement("input",{className:"input",type:"text",placeholder:b?"Video found in clipboard!":"Youtube link",onChange:function(e){m(e.target.value)},value:u})),b&&n.a.createElement("p",{className:"control"},n.a.createElement("span",{className:"button ".concat(""===u?"is-primary":"is-static")},n.a.createElement("ion-icon",{name:"clipboard-outline",style:{marginRight:"0.5rem"}}),b)))),n.a.createElement("div",{className:"field"},n.a.createElement("label",{className:"checkbox"},n.a.createElement("input",{type:"checkbox",name:"onlyHost"}),"\xa0Only allow host to control video")),n.a.createElement("div",{className:"buttons is-right"},n.a.createElement("button",{className:"button is-primary"+(O?" is-loading":"")},"Party")))))))))},O=a(10),j=a(11),C=a(17),T=a(13),k=a(12),P=function(e){Object(T.a)(a,e);var t=Object(k.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(j.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"chat-bubble"},n.a.createElement("span",{className:"chat-name tag ".concat(this.props.chat_data.color_code)},this.props.chat_data.user_name),this.props.chat_data.message)}}]),a}(n.a.Component),R=function(e){var t=e.connectedUsers;return n.a.createElement("div",{className:"username-container"},Object.entries(t).map((function(e){var t=Object(l.a)(e,2),a=(t[0],t[1]);return n.a.createElement("span",{className:"tag ".concat(a.color_code)},a.user_name)})),n.a.createElement("span",{class:"tag is-link is-light"},"Queue (1/1)"))},D=function(e){Object(T.a)(a,e);var t=Object(k.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).add_text=function(e){o.setState({message:e.target.value})},o.send_message=function(e){e.preventDefault(),""!==o.state.message&&(f(o.state.message,o.props.user_name,o.props.is_host,o.props.color_code),o.setState({message:""}))},o.chatBottom=n.a.createRef(),o.state={message:""},o}return Object(j.a)(a,[{key:"componentDidUpdate",value:function(){this.chatBottom.current.scrollIntoView({behavior:"smooth"})}},{key:"render",value:function(){return n.a.createElement("div",{className:"chat-panel box"},n.a.createElement(R,{connectedUsers:this.props.connected_users,only_host_controls:this.props.only_host_controls,is_host:this.props.is_host}),n.a.createElement("div",{className:"chat-message-panel"},this.props.chat_log.map((function(e,t){return n.a.createElement(P,{key:t,chat_data:e})})),n.a.createElement("span",{ref:this.chatBottom,id:"chat-bottom"})),n.a.createElement("form",{onSubmit:this.send_message},n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{className:"control is-expanded"},n.a.createElement("input",{className:"input",value:this.state.message,type:"text",placeholder:"Chat...",onChange:this.add_text})),n.a.createElement("p",{className:"control"},n.a.createElement("button",{className:"button is-primary"},n.a.createElement("ion-icon",{name:"paper-plane"}))))))}}]),a}(n.a.Component),U=(a(30),function(e){Object(T.a)(a,e);var t=Object(k.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).loadScript=function(){if(window.YT)window.YT.Player&&o.loadVideo();else{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=o.loadVideo;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},o.loadVideo=function(){var e=Math.round(window.innerWidth*(window.innerWidth>768?.7:1)),t=Math.round(.6*window.innerHeight),a=Math.min(Math.round(16*t/9),e),n=Math.min(Math.round(9*e/16),t);o.state.player=new window.YT.Player("youtube-player-iframe",{videoId:o.props.youtube_video_id,width:a,height:n,playerVars:{start:Math.ceil(o.props.youtube_current_pos)},events:{onReady:o.onPlayerReady,onStateChange:o.onPlayerStateChange,onPlaybackRateChange:o.onPlayerPlaybackRateChange}}),window.yt_player=o.state.player},o.onPlayerReady=function(e){1===o.props.player_state&&e.target.playVideo()},o.onPlayerStateChange=function(e){o.props.isStateChangeFromBroadcastData||e.data!==window.YT.PlayerState.PLAYING&&e.data!==window.YT.PlayerState.PAUSED||w()},o.onPlayerPlaybackRateChange=function(e){console.log(e),o.props.is_host&&w("playbackRateChange")},console.log(e),o.state={player:""},o}return Object(j.a)(a,[{key:"componentDidUpdate",value:function(){""===this.state.player&&""!==this.props.youtube_video_id&&this.loadScript()}},{key:"render",value:function(){return n.a.createElement("div",{className:"player_container"},n.a.createElement("div",{id:"youtube-player-iframe"}))}}]),a}(n.a.Component)),x=function(e){Object(T.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var o=arguments.length,n=new Array(o),s=0;s<o;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).changeVideo=function(e){e.preventDefault();var t=N(e.target.video_url.value);t&&E(t,!0)},e}return Object(j.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"box info_box"},n.a.createElement("div",{className:""},n.a.createElement("form",{onSubmit:this.changeVideo},n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{className:"control is-expanded"},n.a.createElement("input",{className:"input",type:"text",name:"video_url",placeholder:"Enter new video URL",required:!0})),n.a.createElement("p",{className:"control"},n.a.createElement("button",{className:"button is-primary"},"Change"))))))}}]),a}(n.a.Component),I=a(22);a(59);function B(){var e=["is-black","is-dark","is-light","is-primary","is-link","is-info","is-success","is-warning","is-danger"];return e[Math.floor(Math.random()*e.length)]}var A=function(e){Object(T.a)(a,e);var t=Object(k.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).state={user_name:"",youtube_video_id:"",youtube_current_pos:0,peer_id:"",is_host:!1,chat_log:[],invite_popup_shown:!1,connected_users:{},color_code:"",isStateChangeFromBroadcastData:!1,player_state:!1},o.setUserName=function(e){e.preventDefault();var t=B(),a=o.state.connected_users;a[o.state.peer_id]={user_name:e.target.user_name.value,color_code:t,is_host:!1},o.setState({user_name:e.target.user_name.value,connected_users:a,color_code:t}),g(e.target.user_name.value,t)},o.copyToClipboard=function(e){e.preventDefault(),o.copy_invite.select(),document.execCommand("copy"),o.setState({invite_popup_shown:!0})},o.closeModal=function(e){o.setState({invite_popup_shown:!0})},o.notify=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;I.b.info(e,{position:"bottom-left",autoClose:t,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,toastId:e})},window.global_this_obj=Object(C.a)(o),window.connections=[],o}return Object(j.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.match.params.host_id,t=m(e),a=B(),o=t.connected_users||{},n=JSON.parse(JSON.stringify(o));t?(window.peer_obj||_(!0,null,e),t.connected_users?(delete n[e],function(e,t){var a=function(t){setTimeout((function(){b(e[t])}),250)};for(var o in e)a(o);var n=250*e.length+100;setTimeout((function(){console.log("intro called"),g(t.user_name,t.color_code)}),n)}(Object.keys(n),o[e])):o[e]={user_name:t.userName,color_code:a,is_host:!0},this.setState({peer_id:e,user_name:t.userName,videoUrl:t.videoUrl,youtube_video_id:t.videoId,only_host_controls:t.onlyHostControls,is_host:t.isHost,connected_users:o,color_code:a})):_(!1,e)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"party-container"},n.a.createElement(I.a,{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!1,draggable:!0,pauseOnHover:!0}),n.a.createElement("div",{className:"modal   "+(""===this.state.user_name?"is-active":"")},n.a.createElement("div",{className:"modal-background"}),n.a.createElement("div",{className:"modal-content"},n.a.createElement("div",{className:"box"},n.a.createElement("form",{onSubmit:this.setUserName},n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{className:"control is-expanded"},n.a.createElement("input",{className:"input",type:"text",name:"user_name",placeholder:"Enter Your Username",required:!0})),n.a.createElement("p",{className:"control"},n.a.createElement("button",{className:"button is-primary"},"Party")))))),n.a.createElement("button",{className:"modal-close is-large","aria-label":"close"})),n.a.createElement("div",{className:"modal "+(this.state.invite_popup_shown?"is-active":"")},n.a.createElement("div",{className:"modal-background",onClick:this.closeModal}),n.a.createElement("div",{className:"modal-content"},n.a.createElement("div",{className:"box"},n.a.createElement("form",{onSubmit:this.copyToClipboard},n.a.createElement("label",null,"Share this link with friends to watch YouTube together"),n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{className:"control is-expanded"},n.a.createElement("input",{className:"input",type:"text",value:window.location.href,name:"invite_link",readOnly:!0,ref:function(t){return e.copy_invite=t}})),n.a.createElement("p",{className:"control"},n.a.createElement("button",{className:"button is-primary"},n.a.createElement("span",{role:"img","aria-label":"cliboard_emoji"},"\ud83d\udccb"),"\xa0Copy Invite Link")))))),n.a.createElement("button",{className:"modal-close is-large","aria-label":"close",onClick:this.closeModal})),n.a.createElement("div",null,n.a.createElement(U,{videoUrl:this.state.videoUrl,youtube_video_id:this.state.youtube_video_id,youtube_current_pos:this.state.youtube_current_pos,is_host:this.state.is_host,isStateChangeFromBroadcastData:this.state.isStateChangeFromBroadcastData,player_state:this.state.player_state}),(!1===this.state.only_host_controls||!0===this.state.is_host)&&n.a.createElement(x,null)),n.a.createElement(D,{connected_users:this.state.connected_users,only_host_controls:this.state.only_host_controls,user_name:this.state.user_name,chat_log:this.state.chat_log,is_host:this.state.is_host,color_code:this.state.color_code}))}}]),a}(n.a.Component),V=function(){return n.a.createElement(r.a,null,n.a.createElement(c.d,null,n.a.createElement(c.b,{exact:!0,path:"/",component:S}),n.a.createElement(c.b,{exact:!0,path:"/:host_id",component:A})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.fdc0ca7e.chunk.js.map